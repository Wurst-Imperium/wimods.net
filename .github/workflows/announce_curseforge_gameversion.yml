name: Announce CurseForge GameVersion

on:
  workflow_dispatch:
    inputs:
      version:
        description: "CurseForge game version (e.g. '1.21.11-snapshot')"
        required: true
      type_name:
        description: "Version type name (e.g. 'Minecraft 1.21')"
        required: true
      dry_run:
        description: "Don't actually upload the announcement"
        type: boolean
        default: false
      distinct_id:
        required: false

jobs:
  announce:
    runs-on: ubuntu-latest
    steps:

    - name: Echo distinct ID ${{ inputs.distinct_id }}
      run: echo ${{ inputs.distinct_id }}

    - name: Checkout repository
      uses: actions/checkout@v6

    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: "3.12"
        cache: "pip"
        cache-dependency-path: scripts/requirements.txt

    - name: Install dependencies
      run: pip install -r scripts/requirements.txt

    - name: Run announce_curseforge_gameversion.py
      env:
        WURSTFORUM_TOKEN: ${{ secrets.WF_BOT_TOKEN }}
      run: |
        python scripts/announce_curseforge_gameversion.py \
          "${{ inputs.version }}" \
          "${{ inputs.type_name }}" \
          ${{ inputs.dry_run && '--dry-run' || '' }}
